---
title: "Time window"
author: "Martin Kosík"
date: "8 dubna 2019"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

ł
```{r}
fmla_window <- as.formula(paste("log_n ~ german:hostility + german:pact + german:war +  german:post_war +
                                as.factor(YEAR) + ethnicity + ethnicity:YEAR + ethnicity:YEAR_sq"))

fmla_window_pre_treat <- as.formula("log_n ~ german:pre_treatment + german:hostility + german:pact +
                                    german:war +  german:post_war +  as.factor(YEAR) + 
                                    ethnicity + ethnicity:YEAR + ethnicity:YEAR_sq")

```


```{r}
diff_model_window_pre_treat <- lm(fmla_window_pre_treat, data = min_by_year)
```


```{r}
formula = fmla_window_pre_treat
data = min_by_year
level = 0.95
vcov = "CR2"

  model <- lm(formula,  data = data)
  model %>% 
  conf_int(vcov = vcov,  level = level,
          cluster = data$ethnicity,  test = "Satterthwaite") %>% 
  as_tibble(rownames = "term") %>% 
  filter(str_detect(term, "german:")) %>% 
  mutate(nice_labs = str_replace(term,"german:","") %>% 
           fct_relevel("pre_treatment", "hostility", "pact", "war", "post_war")) %>% 
  rename(conf.low = CI_L, conf.high = CI_U, estimate = beta) %>% 
  ggplot(mapping = aes(x = nice_labs, y = estimate, ymin = conf.low, ymax = conf.high, group = 1))+ 
  geom_pointrange()+  geom_hline(yintercept= 0) + theme_minimal() +
  theme(axis.line = element_line(size = 1), 
        panel.grid.major.x = element_blank(), panel.grid.minor.x = element_blank(), 
        text = element_text(size=14)) + 
  labs(x = element_blank(),
       caption = "error bars show 95% confidence intervals \n 
                    SE are maximum of their cluster robust and standard versions",
       y = "Coefficient"
      # title = "Interactions of German ethnicity with specified time window dummy"
       ) + 
  scale_x_discrete(labels = c("Pre-tretment \n (1930 to 1932)",
                              'Hostility without war \n (1933 to 1938)',
                              'Pact \n (1939 to 1940)', 'War \n (1941 to 1945)',
                              "Post-war \n (from 1945)"))

ggsave(here::here("plots/effects/ethnicity_imputation/annual/time_window_pre_treatment_date_imp.pdf"))
```

